"use strict";function myIsEnd(n){var t=n.split(" : ");alert("恭喜通关，用时 "+t[0]+"分"+t[1]+"秒")}var picData=[10005,20005,30005,40005,60005,80005,90005,100005,120005,130005,140005,150005,160005,170005,180005,190005,200005,210005,220005,230005,240005,250005,270005,280005,300005,310005,320005,320005],musicData=["music1","music2","music3","music4","music5","music6","music7"],POINT_A=null,POINT_B=null,POINT_BOO=!1,CODEARR=[],ROW=6,COLUMN=6,PICNum=9,TOTALNum=ROW*COLUMN,W_line=0,STARTTIME=0,COUNT_STARTTIME=0,isMusic=!1,musicInit=0,temp={TABLE:$("<table cellspacing='0'></table>"),myRow:ROW+2,myColumn:COLUMN+2,init:function(n){var t="start"===n?this.picFn():this.resetPicFn();CODEARR=[],this.TABLE.html(this.trFn(t)),$("#app").html(this.TABLE)},trFn:function(n){for(var t=0,i="";t<this.myRow;t++)CODEARR[t]=[],i+="<tr>"+this.tdFn(t,n[t])+"</tr>";return i},tdFn:function(n,t){for(var i=0,e="";i<this.myColumn;i++)CODEARR[n].push(t[i]),0===n||n===this.myRow-1||0===i||i===this.myColumn-1?e+="<td></td>":null===t[i]?e+='<td><i class="pic-link pic-true"></i></td>':e+='<td id="pic_'+n+"_"+i+'"><i data-x="'+n+'"data-y="'+i+'" class="pic-link pic-'+t[i]+'" ></i></td>';return e},picRandomFn:function(){picData.sort(function(){return.5-Math.random()})},picFn:function(){this.picRandomFn();for(var n=0,t=0,i=picData.length,e=Math.floor(COLUMN*ROW/PICNum),r=Number,a=[],o=[];n<PICNum;n++)r=Math.floor(Math.random()*i),a.push(picData[r]);for(;t<e;t++)o=o.concat(a);return o.sort(function(){return.5-Math.random()}),this.picGroupFn(o)},picGroupFn:function(n){function t(t){for(var i=0,a=n.slice((t-1)*COLUMN,t*COLUMN);i<e.myColumn;i++)0===t||t===e.myRow-1||0===i||i===e.myColumn-1?r[t].push(null):r[t].push(a[i-1])}for(var i=0,e=this,r=[];i<e.myRow;i++)r[i]=[],t(i);return r},resetPicFn:function(){for(var n=0,t=CODEARR.slice(1,CODEARR.length-1),i=[],e=[];n<ROW;n++)i=t[n].slice(1,this.myColumn-1),e=e.concat(i);return e.sort(function(){return.5-Math.random()}),this.picGroupFn(e)}},line={init:function(){},drawCountFn:function(){for(var n=arguments.length,t=0,i=0,e=null,r=null;t<n;t++)i++,e=arguments[t],null!==(r=arguments[i]?arguments[i]:null)&&this.drawFn(e,r,i)},drawFn:function(n,t,i){var e=n.x-t.x>0?t.x:n.x,r=n.y-t.y>0?t.y:n.y,a=0,o=0;n.x===t.x&&(a=Math.abs(t.y-n.y)*W_line,o=1),n.y===t.y&&(a=1,o=Math.abs(t.x-n.x)*W_line),$("#line"+i).addClass("fn-show").css({left:(r+.5)*W_line-2,top:(e+.5)*W_line-2,width:a,height:o})},clearFn:function(){$("#line1, #line2, #line3").removeClass("fn-show").css({width:0,height:0,left:0,top:0})}},countTime={init:function(){function n(){setTimeout(function(){0!==STARTTIME&&(i=Date.parse(new Date),e.html(t.changeUnit(STARTTIME,i)),n())},1e3)}var t=this,i=null,e=$("#fn-time");STARTTIME=Date.parse(new Date),n()},changeUnit:function(n,t){var i=(t-n)/1e3,e=Math.floor(i/3600),r=Math.floor(i/60),a=(i-3600*e)%60;return e>0&&(STARTTIME=0,aletr("已超过1小时，请重新开始")),r<10&&(r="0"+r),a<10&&(a="0"+a),COUNT_STARTTIME=r+" : "+a}},musicFn={idx:musicData.length,init:function(){var n=parseInt(Math.random()*this.idx),t=document.getElementById("fn-music");t.setAttribute("src","music\\"+musicData[n]+".mp3"),t.play(),document.addEventListener("WeixinJSBridgeReady",function(){t.play()},!1)}},common={startView:function(n,t){temp.init(n),"start"===n&&(TOTALNum=ROW*COLUMN,countTime.init()),$("#fn-start").html("重新开始"),$("#fn-reset").removeClass("fn-hide"),$("#app").animate({height:$("#app table").height()}),$("#container").css({width:$("#app table").width()}),W_line=parseInt($("#container").width())/(COLUMN+2),void 0!==t&&void 0!==musicData&&0===musicInit&&(isMusic=t,musicInit=1,musicFn.init())},pointFn:function(n){var t=parseInt(n.attr("data-x")),i=parseInt(n.attr("data-y"));if(line.clearFn(),n.addClass("fn-crt"),!POINT_BOO)return POINT_A={x:t,y:i},void(POINT_BOO=!POINT_BOO);POINT_BOO&&(POINT_B={x:t,y:i},POINT_BOO=!POINT_BOO,this.countPointFn())},countPointFn:function(){(POINT_A.x!==POINT_B.x||POINT_A.y!==POINT_B.y)&&CODEARR[POINT_A.x][POINT_A.y]===CODEARR[POINT_B.x][POINT_B.y]?this.isStep0()||this.isStep1()||this.isStep2()||this.picStatusFn("error"):this.picStatusFn("error")},isStep0:function(){return!!this.compareFn(POINT_A,POINT_B)&&(this.picStatusFn("remove"),line.drawCountFn(POINT_A,POINT_B),!0)},isStep1:function(){var n={x:POINT_A.x,y:POINT_B.y},t={x:POINT_B.x,y:POINT_A.y};return this.compareFn(POINT_A,n,!1)&&this.compareFn(POINT_B,n,!1)&&null===CODEARR[n.x][n.y]?(line.drawCountFn(POINT_A,n,POINT_B),this.picStatusFn("remove"),!0):!(!this.compareFn(POINT_A,t,!1)||!this.compareFn(POINT_B,t,!1)||null!==CODEARR[t.x][t.y])&&(line.drawCountFn(POINT_A,t,POINT_B),this.picStatusFn("remove"),!0)},isStep2:function(){var n=this,t={x:POINT_A.x,y:temp.myColumn},i={x:temp.myRow,y:POINT_A.y},e={x:POINT_A.x,y:0},r={x:0,y:POINT_A.y},a={};if(this.compareSecondFn(POINT_A,t,function(t){if(a={x:POINT_B.x,y:t.y},n.compareFn(t,a)&&null===CODEARR[a.x][a.y]&&n.compareFn(a,POINT_B))return line.drawCountFn(POINT_A,t,a,POINT_B),!0},1))return n.picStatusFn("remove"),!0;if(this.compareSecondFn(POINT_A,i,function(t){if(a={x:t.x,y:POINT_B.y},n.compareFn(t,a)&&null===CODEARR[a.x][a.y]&&n.compareFn(a,POINT_B))return line.drawCountFn(POINT_A,t,a,POINT_B),!0},1))return n.picStatusFn("remove"),!0;if(this.compareSecondFn(POINT_A,e,function(t){if(a={x:POINT_B.x,y:t.y},n.compareFn(t,a)&&null===CODEARR[a.x][a.y]&&n.compareFn(a,POINT_B))return line.drawCountFn(POINT_A,t,a,POINT_B),!0},-1))return n.picStatusFn("remove"),!0;return!!this.compareSecondFn(POINT_A,r,function(t){if(a={x:t.x,y:POINT_B.y},n.compareFn(t,a)&&null===CODEARR[a.x][a.y]&&n.compareFn(a,POINT_B))return line.drawCountFn(POINT_A,t,a,POINT_B),!0},-1)&&(n.picStatusFn("remove"),!0)},compareSecondFn:function(n,t,i,e){var r=0,a=0,o={};if(n.x===t.x)if(r=n.y-t.y>0?t.y:n.y,a=n.y-t.y>0?n.y:t.y,e>0){for(r++;r<a&&null===CODEARR[n.x][r];r++)if(o={x:n.x,y:r},i&&i(o))return!0}else if(e<0)for(a--;a>=r&&null===CODEARR[n.x][a];a--)if(o={x:n.x,y:a},i&&i(o))return!0;if(n.y===t.y)if(r=n.x-t.x>0?t.x:n.x,a=n.x-t.x>0?n.x:t.x,e>0){for(r++;r<a&&null===CODEARR[r][n.y];r++)if(o={x:r,y:n.y},i&&i(o))return!0}else if(e<0)for(a--;a>=r&&null===CODEARR[a][n.y];a--)if(o={x:a,y:n.y},i&&i(o))return!0;return!1},compareFn:function(n,t,i){var e=0,r=0,a=!0;if((i=void 0===i||i)&&(1===Math.abs(n.x-t.x)&&n.y===t.y||1===Math.abs(n.y-t.y)&&n.x===t.x))return a;if(n.x===t.x){for(e=n.y-t.y>0?t.y:n.y,r=n.y-t.y>0?n.y:t.y,e++;e<r;e++)if(null!==CODEARR[n.x][e]){a=!1;break}return a}if(n.y===t.y){for(e=n.x-t.x>0?t.x:n.x,r=n.x-t.x>0?n.x:t.x,e++;e<r;e++)if(null!==CODEARR[e][n.y]){a=!1;break}return a}return!1},picStatusFn:function(n){var t="#pic_"+POINT_A.x+"_"+POINT_A.y,i="#pic_"+POINT_B.x+"_"+POINT_B.y,e=$(t+","+i).find(".pic-link");if(e.removeClass("fn-crt"),"remove"===n)return CODEARR[POINT_A.x][POINT_A.y]=null,CODEARR[POINT_B.x][POINT_B.y]=null,e.removeClass("pic-false").addClass("pic-true"),isMusic&&void 0!==musicData&&musicFn.init(),void this.isTheEndFn();"error"===n&&e.addClass("pic-false")},isTheEndFn:function(){0===(TOTALNum-=2)&&(STARTTIME=0,$("#fn-time").html("00 : 00"),myIsEnd&&myIsEnd(COUNT_STARTTIME))}};({init:function(){/iphone|ipad|android/i.test(navigator.userAgent)?window.location.href="app.html":this.even()},even:function(){$("#app").on("click",".pic-link",function(){$(".pic-link").removeClass("pic-false"),$(this).hasClass("pic-true")||common.pointFn($(this))}),$("#fn-start").on("click",function(){common.startView("start",!0)}),$("#fn-reset").on("click",function(){common.startView("reset",!0)})}}).init();