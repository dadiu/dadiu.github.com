"use strict";var picData=[10005,20005,30005,40005,60005,80005,90005,100005,120005,130005,140005,150005,160005,170005,180005,190005,200005,210005,220005,230005,240005,250005,270005,280005,300005,310005,320005,320005];!function(){var n=null,t=null,i=!1,r=[],e=8,o=8*e,a=parseInt($("#container").width())/(e+2),s={TABLE:$("<table cellspacing='0'></table>"),myRow:10,myColumn:e+2,init:function(n){var t="start"===n?this.picFn():this.resetPicFn();r=[],this.TABLE.html(this.trFn(t)),$("#app").html(this.TABLE)},trFn:function(n){for(var t=0,i="";t<this.myRow;t++)r[t]=[],i+="<tr>"+this.tdFn(t,n[t])+"</tr>";return i},tdFn:function(n,t){for(var i=0,e="";i<this.myColumn;i++)r[n].push(t[i]),0===n||n===this.myRow-1||0===i||i===this.myColumn-1?e+="<td></td>":null===t[i]?e+='<td><i class="pic-link pic-true"></i></td>':e+='<td id="pic_'+n+"_"+i+'"><i data-x="'+n+'"data-y="'+i+'" class="pic-link pic-'+t[i]+'" ></i></td>';return e},picRandomFn:function(){picData.sort(function(){return.5-Math.random()})},picFn:function(){this.picRandomFn();for(var n=0,t=0,i=picData.length,r=Math.floor(8*e/16),o=Number,a=[],s=[];n<16;n++)o=Math.floor(Math.random()*i),a.push(picData[o]);for(;t<r;t++)s=s.concat(a);return s.sort(function(){return.5-Math.random()}),this.picGroupFn(s)},picGroupFn:function(n){function t(t){for(var i=0,a=n.slice((t-1)*e,t*e);i<r.myColumn;i++)0===t||t===r.myRow-1||0===i||i===r.myColumn-1?o[t].push(null):o[t].push(a[i-1])}for(var i=0,r=this,o=[];i<r.myRow;i++)o[i]=[],t(i);return o},resetPicFn:function(){for(var n=0,t=r.slice(1,r.length-1),i=[],e=[];n<8;n++)i=t[n].slice(1,this.myColumn-1),e=e.concat(i);return e.sort(function(){return.5-Math.random()}),this.picGroupFn(e)}},c={init:function(){},drawCountFn:function(){for(var n=arguments.length,t=0,i=0,r=null,e=null;t<n;t++)i++,r=arguments[t],null!==(e=arguments[i]?arguments[i]:null)&&this.drawFn(r,e,i)},drawFn:function(n,t,i){var r=n.x-t.x>0?t.x:n.x,e=n.y-t.y>0?t.y:n.y,o=0,s=0;n.x===t.x&&(o=Math.abs(t.y-n.y)*a,s=1),n.y===t.y&&(o=1,s=Math.abs(t.x-n.x)*a),$("#line"+i).addClass("fn-show").css({left:(e+.5)*a,top:(r+.5)*a,width:o,height:s})},clearFn:function(){$("#line1, #line2, #line3").removeClass("fn-show").css({width:0,height:0,left:0,top:0})}};({init:function(){this.startView("start"),c.init(),this.even()},startView:function(n){s.init(n),"start"===n&&(o=8*e),$("#fn-start").html("重新开始"),$("#fn-reset").removeClass("fn-hide"),$("#app").animate({height:$("#app table").height()})},even:function(){var n=this;if(!/iphone|ipad|android/i.test(navigator.userAgent))return $("#app").on("click",".pic-link",function(){$(".pic-link").removeClass("pic-false"),$(this).hasClass("pic-true")||n.pointFn($(this))}),$("#fn-start").on("click",function(){n.startView("start")}),void $("#fn-reset").on("click",function(){n.startView("reset")});$("#app").on("touchend",".pic-link",function(){$(".pic-link").removeClass("pic-false"),$(this).hasClass("pic-true")||n.pointFn($(this))}),$("#fn-start").on("touchend",function(){n.startView("start")}),$("#fn-reset").on("touchend",function(){n.startView("reset")})},pointFn:function(r){var e=parseInt(r.attr("data-x")),o=parseInt(r.attr("data-y"));if(c.clearFn(),r.addClass("fn-crt"),!i)return n={x:e,y:o},void(i=!i);i&&(t={x:e,y:o},i=!i,this.countPointFn())},countPointFn:function(){console.log(n),console.log(t),(n.x!==t.x||n.y!==t.y)&&r[n.x][n.y]===r[t.x][t.y]?this.isStep0()||this.isStep1()||this.isStep2()||this.picStatusFn("error"):this.picStatusFn("error")},isStep0:function(){return!!this.compareFn(n,t)&&(this.picStatusFn("remove"),c.drawCountFn(n,t),!0)},isStep1:function(){var i={x:n.x,y:t.y},e={x:t.x,y:n.y};return this.compareFn(n,i,!1)&&this.compareFn(t,i,!1)&&null===r[i.x][i.y]?(c.drawCountFn(n,i,t),this.picStatusFn("remove"),!0):!(!this.compareFn(n,e,!1)||!this.compareFn(t,e,!1)||null!==r[e.x][e.y])&&(c.drawCountFn(n,e,t),this.picStatusFn("remove"),!0)},isStep2:function(){var i=this,e={x:n.x,y:s.myColumn},o={x:s.myRow,y:n.y},a={x:n.x,y:0},u={x:0,y:n.y},l={};if(this.compareSecondFn(n,e,function(e){if(l={x:t.x,y:e.y},i.compareFn(e,l)&&null===r[l.x][l.y]&&i.compareFn(l,t))return c.drawCountFn(n,e,l,t),!0},1))return i.picStatusFn("remove"),!0;if(this.compareSecondFn(n,o,function(e){if(l={x:e.x,y:t.y},i.compareFn(e,l)&&null===r[l.x][l.y]&&i.compareFn(l,t))return c.drawCountFn(n,e,l,t),!0},1))return i.picStatusFn("remove"),!0;if(this.compareSecondFn(n,a,function(e){if(l={x:t.x,y:e.y},i.compareFn(e,l)&&null===r[l.x][l.y]&&i.compareFn(l,t))return c.drawCountFn(n,e,l,t),!0},-1))return i.picStatusFn("remove"),!0;return!!this.compareSecondFn(n,u,function(e){if(l={x:e.x,y:t.y},i.compareFn(e,l)&&null===r[l.x][l.y]&&i.compareFn(l,t))return c.drawCountFn(n,e,l,t),!0},-1)&&(i.picStatusFn("remove"),!0)},compareSecondFn:function(n,t,i,e){var o=0,a=0,s={};if(n.x===t.x)if(o=n.y-t.y>0?t.y:n.y,a=n.y-t.y>0?n.y:t.y,e>0){for(o++;o<a&&null===r[n.x][o];o++)if(s={x:n.x,y:o},i&&i(s))return!0}else if(e<0)for(a--;a>=o&&null===r[n.x][a];a--)if(s={x:n.x,y:a},i&&i(s))return!0;if(n.y===t.y)if(o=n.x-t.x>0?t.x:n.x,a=n.x-t.x>0?n.x:t.x,e>0){for(o++;o<a&&null===r[o][n.y];o++)if(s={x:o,y:n.y},i&&i(s))return!0}else if(e<0)for(a--;a>=o&&null===r[a][n.y];a--)if(s={x:a,y:n.y},i&&i(s))return!0;return!1},compareFn:function(n,t,i){var e=0,o=0,a=!0;if((i=void 0===i||i)&&(1===Math.abs(n.x-t.x)&&n.y===t.y||1===Math.abs(n.y-t.y)&&n.x===t.x))return a;if(n.x===t.x){for(e=n.y-t.y>0?t.y:n.y,o=n.y-t.y>0?n.y:t.y,e++;e<o;e++)if(null!==r[n.x][e]){a=!1;break}return a}if(n.y===t.y){for(e=n.x-t.x>0?t.x:n.x,o=n.x-t.x>0?n.x:t.x,e++;e<o;e++)if(null!==r[e][n.y]){a=!1;break}return a}return!1},picStatusFn:function(i){var e="#pic_"+n.x+"_"+n.y,o="#pic_"+t.x+"_"+t.y,a=$(e+","+o).find(".pic-link");if(a.removeClass("fn-crt"),"remove"===i)return r[n.x][n.y]=null,r[t.x][t.y]=null,a.removeClass("pic-false").addClass("pic-true"),void this.isTheEndFn();"error"===i&&a.addClass("pic-false")},isTheEndFn:function(){0===(o-=2)&&alert("恭喜通关")}}).init()}();